# 12 系统差距分析与下阶段开发计划

> 更新时间: 2026-02-27
> **状态: Sprint 1-4 + 技术债 全部完成 ✅**

## 一、已完成功能清单 (Phase 1-5)

### 页面 (17个)
| 页面 | 路径 | 状态 |
|------|------|------|
| 首页 | `/` | ✅ |
| 登录 | `/login` | ✅ |
| Dashboard | `/dashboard` | ✅ KPI卡片+最近请求 |
| 变更请求列表 | `/dashboard/requests` | ✅ 搜索/筛选/分页 |
| 变更请求详情 | `/dashboard/requests/[id]` | ✅ 状态变更/评论/附件/审批 |
| 看板视图 | `/dashboard/requests/kanban` | ✅ 5列+快速移动 |
| Item Master | `/dashboard/items` | ✅ EBS Oracle查询 |
| Analytics | `/dashboard/analytics` | ✅ Recharts图表 |
| 报表中心 | `/dashboard/reports` | ✅ 5维度+SLA |
| 审批中心 | `/dashboard/approvals` | ✅ 卡片式+审批对话框 |
| 数据字典 | `/dashboard/dictionary` | ✅ 14种MDM字段 |
| 审计日志 | `/dashboard/audit` | ✅ 分页表格 |
| 系统配置 | `/dashboard/admin/config` | ✅ 5组18项 |
| 定时任务 | `/dashboard/admin/jobs` | ✅ CRUD+手动触发 |
| 健康检查 | `/dashboard/admin/health` | ✅ DB/系统/进程 |
| 用户管理 | `/dashboard/settings` | ✅ CRUD+角色 |
| 帮助文档 | `/dashboard/help` | ✅ 7个Tab |

### API (27个端点)
- Auth: NextAuth (Credentials)
- CRUD: requests, users, comments, attachments, approvals
- 业务: ingest, stats, reports, export, import, items/search
- 管理: admin/config, admin/health, admin/jobs

### 数据库 (12个模型)
User, Account, Session, VerificationToken, ChangeRequest, Approval, Comment, Attachment, AuditLog, SystemConfig, ScheduledJob, JobRun

---

## 二、差距分析 — 缺失功能

### 🔴 P0 — 核心缺失（影响日常使用）

| # | 功能 | 说明 | 工作量 |
|---|------|------|--------|
| G1 | **通知系统** | 状态变更/审批结果无通知，用户不知道该处理什么 | 2天 |
| G2 | **仪表板通知中心** | 铃铛图标+未读消息+标记已读 | 1天 |
| G3 | **Dark Mode** | 企业应用标配，shadcn/ui原生支持 | 0.5天 |
| G4 | **个人设置页** | 修改密码、通知偏好、主题切换 | 1天 |
| G5 | **Toast/实时反馈优化** | 部分操作缺少成功/失败反馈 | 0.5天 |

### 🟡 P1 — 体验提升（提升专业度）

| # | 功能 | 说明 | 工作量 |
|---|------|------|--------|
| G6 | **表格排序** | 列表页点击列头排序 | 0.5天 |
| G7 | **保存筛选视图** | 常用筛选条件保存/共享（Phase 2.11 未做） | 1天 |
| G8 | **批量操作** | 批量状态变更/批量审批/批量删除 | 1天 |
| G9 | **详情页Timeline** | 变更历史以时间线形式展示（而非表格） | 0.5天 |
| G10 | **Dashboard Widget可配置** | 用户自选想看的KPI卡片/图表 | 1.5天 |
| G11 | **评论@提及** | @用户名触发通知 | 1天 |
| G12 | **Breadcrumb导航** | 面包屑层级导航 | 0.3天 |
| G13 | **数据表格组件升级** | 用TanStack Table替代手写table，支持列调整/固定/虚拟滚动 | 2天 |

### 🟢 P2 — 锦上添花

| # | 功能 | 说明 | 工作量 |
|---|------|------|--------|
| G14 | **公告管理** | 系统公告/维护通知（Phase 5.6） | 1天 |
| G15 | **SLA预警** | 接近/超过SLA自动标红+通知 | 1天 |
| G16 | **收藏/关注** | 关注特定请求，变更时通知 | 0.5天 |
| G17 | **快捷操作** | 列表页行内快捷按钮（审批/状态变更） | 0.5天 |
| G18 | **PDF导出** | 单条请求导出为PDF报告 | 1天 |
| G19 | **多语言(i18n)** | 中英文切换 | 2天 |
| G20 | **实时更新(WebSocket)** | 多用户协作时实时刷新 | 2天 |

---

## 三、shadcn/ui 组件升级建议

### 当前已安装 (17个)
badge, button, card, dialog, dropdown-menu, input, label, select, separator, sheet, sidebar, skeleton, sonner, table, tabs, textarea, tooltip

### 建议新增组件

| 组件 | 用途 | 优先级 |
|------|------|--------|
| **avatar** | 用户头像（侧边栏、评论、审批） | P0 |
| **breadcrumb** | 面包屑导航 | P0 |
| **alert** | 系统通知/警告消息 | P0 |
| **switch** | 系统配置boolean切换（替代当前Button方案） | P0 |
| **progress** | 进度条（健康检查内存、SLA达标率） | P0 |
| **popover** | 筛选弹出面板、通知面板 | P1 |
| **calendar** | 日期筛选 | P1 |
| **date-picker** | 日期范围选择（报表、导出） | P1 |
| **chart** | shadcn/ui原生图表（可替代Recharts） | P1 |
| **command** | 升级命令面板（当前用cmdk） | P1 |
| **scroll-area** | 自定义滚动条（列表/日志） | P1 |
| **collapsible** | 侧边栏折叠分组（Admin区域） | P1 |
| **accordion** | FAQ页面折叠（替代当前实现） | P2 |
| **toggle-group** | 视图切换（列表/看板/卡片） | P2 |
| **data-table** | TanStack Table封装（官方推荐） | P2 |
| **pagination** | 标准分页组件 | P1 |
| **resizable** | 可调整面板宽度 | P2 |

---

## 四、UI/UX 提升专项

### 4.1 整体视觉
- [ ] **Dark Mode** — next-themes + shadcn/ui CSS变量
- [ ] **Avatar组件** — 替代当前User图标
- [ ] **品牌色调整** — 自定义主色调（当前默认黑白）
- [ ] **Loading状态** — 全局加载指示器（NProgress或类似）
- [ ] **空状态设计** — 空列表/无数据时的插画+引导

### 4.2 导航体验
- [ ] **Breadcrumb** — 所有二级+页面
- [ ] **侧边栏折叠** — Collapsible分组（MDM / Admin / Help）
- [ ] **活跃指示** — 审批/通知未读数Badge

### 4.3 表格/列表
- [ ] **TanStack Table** — 列排序、列可见性切换、列宽调整
- [ ] **Pagination组件** — 标准化分页（当前手写按钮）
- [ ] **行操作菜单** — 右侧...按钮展开操作
- [ ] **虚拟滚动** — 大数据量列表性能优化

### 4.4 表单体验
- [ ] **Switch替代Button** — 配置页boolean值
- [ ] **DatePicker** — 日期字段选择器
- [ ] **Combobox** — 可搜索下拉（Item选择、用户选择）
- [ ] **Form验证反馈** — 实时字段校验+错误提示

---

## 五、推荐开发顺序

### Sprint 1 — UI基础升级 (2-3天)
1. 安装新组件: avatar, breadcrumb, alert, switch, progress, popover, pagination, scroll-area
2. Dark Mode (next-themes)
3. Breadcrumb导航
4. Switch替代配置页Button
5. Progress替代健康检查手写进度条
6. Avatar用户头像
7. Pagination标准化

### Sprint 2 — 通知系统 (2-3天)
1. Notification模型 (Prisma)
2. 通知API (CRUD + 标记已读)
3. Header铃铛图标 + 未读数Badge
4. 通知弹出面板 (Popover)
5. 状态变更/审批时自动创建通知
6. 个人设置页（密码修改+通知偏好+主题）

### Sprint 3 — 表格与交互 (2-3天)
1. TanStack Table集成
2. 列排序/列可见性
3. 批量选择+批量操作
4. 行内快捷操作
5. 保存筛选视图

### Sprint 4 — 细节打磨 (1-2天)
1. 详情页Timeline视图
2. 空状态设计
3. 全局Loading指示器
4. Toast反馈完善
5. 侧边栏Collapsible分组

### （暂缓 — 等PLM/EBS对接后）
- Phase 3: 数据质量规则引擎
- Phase 4: 集成连接器 + 变更同步引擎
- G15: SLA预警
- G19: 多语言
- G20: WebSocket实时更新

---

## 六、技术债

| 项目 | 说明 | 优先级 |
|------|------|--------|
| middleware废弃警告 | Next.js 16提示用proxy替代middleware | P1 |
| Prisma DLL锁 | Windows下dev server锁Prisma client DLL | P2 (已知workaround) |
| 测试覆盖率 | 0% — 无单元测试/E2E测试 | P1 |
| API输入验证 | 部分API缺少Zod schema验证 | P1 |
| 错误边界 | 缺少React Error Boundary | P1 |
| SEO/Meta | 缺少页面metadata | P2 |
| 环境变量管理 | 硬编码值应移到.env | P2 |
