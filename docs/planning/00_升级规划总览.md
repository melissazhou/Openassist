# OpenAssist 升级规划总览

## 实施状态 (2026-02-26 更新)

| 步骤 | 状态 |
|---|---|
| 规划文档 (00-11) | ✅ 完成 |
| 环境搭建 (Docker PG+Redis) | ✅ 完成 |
| Next.js 项目初始化 | ✅ 完成 (16.1.6 + Turbopack) |
| Prisma schema + migration | ✅ 完成 (6.16.3, init migration) |
| shadcn/ui 组件库 | ✅ 完成 (18个组件) |
| 种子数据 (4用户) | ✅ 完成 |
| 生产构建验证 | ✅ 通过 |
| Phase 1: 认证 (NextAuth) | ✅ 完成 |
| Phase 1: Dashboard (统计+最近请求) | ✅ 完成 |
| Phase 1: Change Request CRUD | ✅ 完成 |
| Phase 1: 数据迁移 (JSON→PG) | ✅ 完成 (420条唯一记录) |
| Phase 1: Smart Parser (TS移植) | ✅ 完成 |
| Phase 1: Ingest API 重建 | ✅ 完成 |
| Phase 1: UI 响应式 + 删除确认 | ✅ 完成 |
| Phase 1: 全局搜索 (⌘K) | ✅ 完成 |
| Phase 2: Analytics (图表) | ✅ 完成 |
| Phase 2: 用户管理 CRUD | ✅ 完成 |
| Phase 2: 审计日志查看 | ✅ 完成 |
| Phase 2: 数据导出 CSV | ✅ 完成 |
| Phase 2: 审批工作流 + 审批中心 | ✅ 完成 |
| Phase 2: 附件管理 | ✅ 完成 |
| Phase 2: 批量导入 (CSV) | ✅ 完成 |
| Phase 2: 看板视图 | ✅ 完成 |
| **Phase 2 全部完成** | ✅ |
| Schema 重构 (MDM字段细化) | ✅ 完成 |
| 数据重新迁移 (全字段保留) | ✅ 完成 (3102条) |
| Item Master 查询 (EBS/PLM) | ✅ 完成 |
| 物料变更记录交叉引用 | ✅ 完成 |
| Phase 3: 数据字典 | ✅ 完成 |
| Phase 3: Analytics MDM Field 图表 | ✅ 完成 |
| Phase 3: 详情页字段丰富 | ✅ 完成 |
| Phase 3: 变更历史 API | ✅ 完成 |
| Phase 3: CSV 导出增强 | ✅ 完成 |

**项目路径:** `D:\Project\OpenAssist`
**技术栈:** Next.js 16.1.6 + shadcn/ui + Prisma 6.16.3 + PostgreSQL 16 + Redis 7

---

## 一、现状分析

### 当前技术栈
| 层 | 技术 | 问题 |
|---|---|---|
| 前端 | Flask Jinja2 模板 | 传统服务端渲染，交互体验差，无组件化 |
| 后端 | Flask + Blueprint | 轻量但缺乏企业级特性(ORM/Migration/Queue等) |
| 数据库 | JSON文件 (`change_requests.json`) | 无事务/索引/并发/备份，3000+记录已是瓶颈 |
| 认证 | 硬编码4用户 + IWMS SSO | 无RBAC/审计日志/密码策略 |
| API | REST (Flask路由) | 无版本管理/限流/文档/Schema验证 |
| 部署 | 本地开发模式 | 无CI/CD/容器化/环境管理 |

### 当前功能
- MDM变更请求 ingest/查询/过滤
- Smart Parser（9类别文本解析）
- Stats Dashboard
- 基本用户认证

### 缺失的企业级能力（与成熟MDM系统对比）
参照 Informatica MDM、SAP Master Data Governance、Reltio、Profisee 等系统：

---

## 二、目标技术架构

### 推荐方案: Next.js 全栈 + PostgreSQL

```
┌─────────────────────────────────────────────┐
│                 前端 (Next.js 15)             │
│  App Router + Server Components + shadcn/ui  │
│  TanStack Table / React Hook Form / Zustand  │
├─────────────────────────────────────────────┤
│              API Layer (Next.js)              │
│  Route Handlers + tRPC (可选) + Zod验证       │
│  NextAuth.js (认证) + CASL (权限)            │
├─────────────────────────────────────────────┤
│             ORM & 数据层                      │
│  Prisma ORM + PostgreSQL 16                  │
│  Redis (缓存/队列) + BullMQ (任务队列)        │
├─────────────────────────────────────────────┤
│              基础设施                         │
│  Docker Compose (开发) → K8s/Docker (生产)    │
│  GitHub Actions CI/CD                        │
└─────────────────────────────────────────────┘
```

### 为什么选 Next.js 而非其他
| 选项 | 优势 | 劣势 |
|---|---|---|
| **Next.js (推荐)** | 全栈统一、SSR/SSG、生态最丰富、shadcn/ui美观 | 学习曲线比Flask陡 |
| Flask + React SPA | 后端熟悉 | 前后端分离维护成本高 |
| Django + HTMX | Python生态 | 前端交互能力有限 |
| .NET Blazor | 企业级 | 技术栈跨度大 |

### UI框架选择: shadcn/ui + Tailwind CSS
- 企业级外观，高度可定制
- 基于 Radix UI 无障碍组件
- 现成的 DataTable、Form、Dialog、Command 等组件
- 暗色/亮色主题切换

---

## 三、功能规划（按优先级分阶段）

### Phase 1: 基础框架迁移（2-3周）
1. Next.js项目初始化 + TypeScript
2. PostgreSQL数据库设计 + Prisma Schema
3. 认证系统 (NextAuth.js + IWMS SSO集成)
4. JSON数据迁移脚本
5. 基础CRUD页面（变更请求列表/详情）
6. Dashboard重建 (shadcn/ui charts)

### Phase 2: 企业级核心功能（3-4周）
7. **RBAC权限系统** — 角色/权限/数据范围
8. **审批工作流引擎** — 多级审批/会签/委托
9. **审计日志** — 全操作记录/变更追溯
10. **通知系统** — 邮件/站内信/Webhook
11. **数据导入导出** — Excel/CSV批量操作
12. **高级搜索与过滤** — 保存筛选条件/全文搜索

### Phase 3: MDM核心能力（4-6周）
13. **数据质量规则引擎** — 校验/清洗/标准化规则配置
14. **数据匹配与去重** — 模糊匹配/合并建议
15. **变更影响分析** — 修改一条主数据，影响哪些下游系统
16. **数据血缘与谱系** — 数据从哪来/到哪去
17. **批量变更管理** — 批量提交/审批/执行
18. **版本管理** — 数据历史版本对比/回滚
19. **数据标准/字典管理** — 统一编码/命名/分类标准

### Phase 4: 集成与智能化（3-4周）
20. **系统集成框架** — EBS/WMS/MES 连接器配置
21. **变更同步引擎** — 审批通过后自动同步到目标系统
22. **AI辅助** — 智能分类/自动填充/异常检测
23. **报表与分析** — 可视化仪表板/KPI追踪
24. **API网关** — 版本管理/限流/文档(Swagger)

### Phase 5: 运维与治理（2-3周）
25. **系统配置管理** — 环境变量/功能开关/系统参数
26. **定时任务管理** — 调度/监控/日志
27. **健康检查与监控** — 系统状态/性能指标
28. **备份恢复** — 自动备份/恢复演练
29. **多环境管理** — DEV/UAT/PRD配置隔离

---

## 四、数据库设计概要

### 核心表
```
users / roles / permissions / user_roles
change_requests / cr_items / cr_approvals / cr_comments
audit_logs / notifications
data_standards / data_dictionaries
data_quality_rules / dq_results
system_configs / integration_configs
workflows / workflow_steps / workflow_instances
```

### 环境规划
| 环境 | 用途 | 数据库 |
|---|---|---|
| DEV | 本地开发 | PostgreSQL (Docker) |
| UAT | 用户验收 | PostgreSQL (服务器) |
| PRD | 生产 | PostgreSQL (服务器，带备份) |

---

## 五、文档体系

详见各分文档：

| 文档 | 内容 |
|---|---|
| `01_技术架构设计.md` | 详细架构/技术选型/目录结构 |
| `02_数据库设计.md` | ER图/表结构/索引/迁移策略 |
| `03_API设计规范.md` | 接口规范/错误码/认证/版本 |
| `04_认证与权限设计.md` | RBAC模型/SSO集成/权限矩阵 |
| `05_审批工作流设计.md` | 工作流引擎/状态机/规则配置 |
| `06_数据质量规则.md` | 规则引擎/校验/清洗/标准化 |
| `07_系统集成设计.md` | EBS/WMS连接器/同步机制 |
| `08_前端UI规范.md` | 组件库/页面布局/交互规范 |
| `09_部署与环境.md` | Docker/CI-CD/环境配置/监控 |
| `10_数据迁移方案.md` | JSON→PG迁移/数据清洗/验证 |
| `11_功能需求清单.md` | 详细功能列表/用户故事/验收标准 |

---

## 六、与现有系统的关系

```
SharePoint MDM List ──抓取──→ OpenAssist (变更请求管理)
                                    │
                              审批通过后
                                    │
                    ┌───────────────┼───────────────┐
                    ▼               ▼               ▼
               Oracle EBS      IWMS WMS        其他系统
              (主数据变更)    (映射表更新)    (未来扩展)
```

OpenAssist的定位: **MDM变更请求的中枢管理平台**，未来逐步承载数据标准、数据质量、数据血缘等数据治理能力。
